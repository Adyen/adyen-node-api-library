/*
 * The version of the OpenAPI document: v1
 * 
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit this class manually.
 */

import { acsWebhooks } from "..";

/**
 * Union type for all supported webhook requests.
 * Allows generic handling of configuration-related webhook events.
 */
export type GenericWebhook = 
    | acsWebhooks.AuthenticationNotificationRequest
    | acsWebhooks.RelayedAuthenticationRequest;

/**
 * Handler for processing AcsWebhooks.
 * 
 * This class provides functionality to deserialize the payload of AcsWebhooks events.
 */
export class AcsWebhooksHandler {

    private readonly payload: Record<string, any>;

    public constructor(jsonPayload: string) {
        this.payload = JSON.parse(jsonPayload);
    }

    /**
     * This method checks the type of the webhook payload and returns the appropriate deserialized object.
     * 
     * @returns A deserialized object of type GenericWebhook.
     * @throws Error if the type is not recognized.
     */
    public getGenericWebhook(): GenericWebhook {
    
        const type = this.payload["type"];
        
        if(Object.values(acsWebhooks.AuthenticationNotificationRequest.TypeEnum).includes(type)) {
            return this.getAuthenticationNotificationRequest();
        }
        
        // manually commented out: RelayedAuthenticationRequest has no TypeEnum
        // if(Object.values(acsWebhooks.RelayedAuthenticationRequest.TypeEnum).includes(type)) {
        //     return this.getRelayedAuthenticationRequest();
        // }
        if(!type && this.payload["paymentInstrumentId"]){
            // ad-hoc fix for the relayed authentication request
            // if type is undefined but paymentInstrumentId is present then it is a relayedAuthenticationRequest
            return this.getRelayedAuthenticationRequest();
        }
        
        throw new Error("Could not parse the json payload: " + this.payload);

    }

    /**
     * Deserialize the webhook payload into a AuthenticationNotificationRequest
     *
     * @returns Deserialized AuthenticationNotificationRequest object.
     */
    public getAuthenticationNotificationRequest(): acsWebhooks.AuthenticationNotificationRequest {
        return acsWebhooks.ObjectSerializer.deserialize(this.payload, "AuthenticationNotificationRequest");
    }

    /**
     * Deserialize the webhook payload into a RelayedAuthenticationRequest
     *
     * @returns Deserialized RelayedAuthenticationRequest object.
     */
    public getRelayedAuthenticationRequest(): acsWebhooks.RelayedAuthenticationRequest {
        return acsWebhooks.ObjectSerializer.deserialize(this.payload, "RelayedAuthenticationRequest");
    }

}